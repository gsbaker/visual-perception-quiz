{% extends 'quiz/base.html' %}

{% block content %}

    <div class="text-center">
    <div class="bg-danger text-white d-inline p-2 rounded-3">
        Answer as quickly as possible
    </div>
    </div>


    <div class="d-flex flex-wrap justify-content-evenly">
        <div class="p-4 text-center">
            <h1>{{ current_question.question_text }}</h1>
            {% load static %} <img src="{% static image_path %}" class="img-fluid rounded" alt="Lines" id="lines-image">
        </div>

        <div class="p-4">
            <h5>Here's how others answered</h5>
            {% for choice in current_question.choice_set.all %}
                <div class="mt-3">
                    <h6>{{ choice.choice_text }}</h6>
                    <div class="progress-bar-container">
                        <div id="progress-bar-{{ forloop.counter }}" class="bg-primary progress-bar">&nbsp</div>
                    </div>
                    <div id="progress-bar-{{ forloop.counter }}-message">Waiting for answers...</div>
                </div>
            {% endfor %}
        </div>
    </div>

    <hr>

    <form method="post" class="mt-3">
        {% csrf_token %}
        <p class="fw-bold">Please select your answer:</p>

        <div class="mt-4">
            {{ form }}
        </div>

        <div>
            {% if next_question %}
                <input type="submit" name="next" value="Next" class="btn btn-outline-primary mt-2">
                </div>
            {% else %}
                <input type="submit" name="next" value="Submit" class="btn btn-outline-primary mt-2">
            {% endif %}
        </div>
    </form>

    <script>
        function updateProgress(progressBarElement, progressBarMessageElement, progress) {
            progressBarElement.style.width = progress.percent + "%";
            progressBarMessageElement.innerHTML = Math.round((progress.current / progress.total) * 100) + "%";
        }

        function generateProgress(choices) {
            for (let i = 0; i < choices.length; i ++) {
                let percentage = choices[i].fields.percentage;
                let progressBar = document.getElementById("progress-bar-" + (i + 1));
                let progressBarMessage = document.getElementById("progress-bar-" + (i + 1) + "-message");
                for (let i = 0; i < 11; i ++) {
                    setTimeout(updateProgress, 80 * i, progressBar, progressBarMessage, {
                        percent: (percentage / 10) * i,
                        current: (percentage / 10) * i,
                        total: 100
                    })
                }
            }
        }
        setTimeout(() => generateProgress({{ choices_json|safe }}), 1000);
    </script>

{% endblock %}